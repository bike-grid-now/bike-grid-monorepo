---
import Agenda from "../lib/components/Agenda.svelte";
import Slides from "../lib/components/Slides.svelte";
import Hero from "../components/Hero.astro";
import CallToActionList from "../components/CallToActionList.astro";
import CardContainer from "../components/CardContainer.astro";

import Container from "../components/Container.astro";
import Layout from "../layouts/Layout.astro";
import {
  upcomingEvents,
  pastEvents,
  type Event,
  getSiteSettings,
} from "../lib/sanity";

function mapEvent({
  slug: { current: slug },
  name,
  date: { local: date },
  poster,
}: Event) {
  return { slug, name, date, poster: poster! };
}

const [futureEventsList, pastEventsList, siteSettings] = await Promise.all([
  upcomingEvents(),
  pastEvents(),
  getSiteSettings(),
]);

const data = {
  pastEvents: pastEventsList.map(mapEvent) || [],
  upcomingEvents: futureEventsList.map(mapEvent) || [],
  siteSettings,
};

const nextEvent = upcomingEvents.length > 0 ? data.upcomingEvents[0] : null;
---

<Layout title="">
  <Hero title={siteSettings.heroTitle} tagline={siteSettings.heroTagline} />

  <Container>
    <div class="py-5 main-content mt-6 space-y-6">
      <CallToActionList />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        {nextEvent && <Slides events={data.upcomingEvents} />}

        {
          upcomingEvents.length > 0 && (
            <Agenda
              events={data.upcomingEvents}
              title="Upcoming Events"
              client:visible
            />
          )
        }
      </div>

      <CardContainer />
      <Agenda events={data.pastEvents} title="Past Events" client:visible />
    </div>
  </Container>
</Layout>
